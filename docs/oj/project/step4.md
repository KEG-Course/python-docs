## Step 4：评测列表与管理

---

### 模块目标

实现评测任务的列表查询、单个评测详情、重新评测等功能，支持分页、筛选、权限控制。

---

### 前置知识要求

| 技术点         | 推荐学习内容           |
| -------------- | ---------------------- |
| 数据结构设计   | 列表、字典、分页       |
| REST API 设计  | GET/PUT 路由           |
| 权限控制       | 用户/管理员区分        |

---

### 任务分解

#### 任务 1：评测列表查询
- 目标：提供 API 查询评测任务列表，支持分页、筛选。
- 要点：可按用户、题目、状态等筛选，支持分页参数。

#### 任务 2：单个评测详情
- 目标：提供 API 查询单个评测任务的详细信息。
- 要点：需校验权限，仅本人或管理员可查。

#### 任务 3：重新评测
- 目标：管理员可对评测任务发起重新评测。
- 要点：需校验管理员权限，重新评测后状态变为 Pending。

---

### 主要 API 设计

#### 1. 查询评测列表
- 路径：`GET /api/submissions/`
- 参数：
  - `user_id` (int, 可选): 按用户筛选
  - `problem_id` (int, 可选): 按题目筛选
  - `status` (str, 可选): 按状态筛选
  - `page` (int, 可选): 页码
  - `page_size` (int, 可选): 每页数量
- 响应：
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "total": 100,
    "submissions": [
      {"submission_id": 1, "user_id": 1, "problem_id": 1001, "status": "Accepted", "score": 100, "time": 0.23}
    ]
  }
}
```
- 异常：无

#### 2. 查询单个评测详情
- 路径：`GET /api/submissions/{submission_id}`
- 权限：仅本人或管理员
- 响应：详见 [api.md](../api.md)
- 异常：
  - 404 评测不存在
  - 403 权限不足

#### 3. 重新评测
- 路径：`PUT /api/submissions/{submission_id}/rejudge`
- 权限：仅管理员
- 参数：无
- 响应：
```json
{
  "code": 200,
  "msg": "rejudge started",
  "data": {"submission_id": 1, "status": "Pending"}
}
```
- 异常：
  - 404 评测不存在
  - 403 权限不足

---

### 状态码与异常
- 详见 [api.md](../api.md)
- 权限不足：403
- 资源不存在：404
- 其他错误：500

---

### 能力小结

| 能力项         | 说明                       |
| -------------- | -------------------------- |
| 评测列表       | 支持多条件筛选与分页       |
| 评测详情       | 查询单个评测详细信息       |
| 重新评测       | 管理员可发起重新评测       |
| 权限控制       | 本人/管理员权限校验        |

---

### 评分细则

| 功能/接口                | 分值 | 评分说明                         |
|--------------------------|------|----------------------------------|
| 评测列表查询接口         | 2    | 多条件筛选、分页                  |
| 单个评测详情接口         | 2    | 权限校验、响应结构                |
| 重新评测接口             | 2    | 权限、状态变更、异常              |
| 权限与安全说明           | 1    | 权限控制、接口安全                |
| 文档与实现一致性         | 1    | 文档与实际实现同步                |
| **小计**                 | **8**|                                  |