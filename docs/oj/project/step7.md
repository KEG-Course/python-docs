## Step 7：持久化与安全控制

---

### 模块目标

本模块要求你完成两项核心任务：

1. 实现 OJ 系统的**数据持久化**，确保核心数据不会因系统重启或异常而丢失。
2. 实现**基础安全控制**，防止用户或系统执行危险操作（如 rm -rf 等破坏性命令）。

---

### 任务 1：数据持久化

你需要将 OJ 系统的核心数据保存到本地文件或数据库。即使系统重启或异常退出，数据也能恢复。

**建议持久化的核心内容包括：**
- 用户信息：用户名、加密密码、权限（如普通用户/管理员）。
- 题目信息：题目编号、标题、描述、输入输出说明、样例。
- 提交/评测记录：每次提交的用户、题目、代码、提交时间、评测结果。
- 比赛信息（如有）：比赛编号、名称、时间、题目列表、参赛用户。

你可以选择只持久化上述内容，不要求所有细节都持久化，但必须保证系统重启后这些数据能恢复。

**举例：**
- 用户A注册、管理员添加题目、用户B提交评测，这些操作都要写入本地存储（如 JSON 文件或 SQLite 数据库）。
- 系统断电重启后，所有用户、题目、提交、比赛等信息都能恢复。

---

### 任务 2：基础安全控制

你需要为 OJ 系统实现基础的安全防护，防止用户或系统执行危险操作。

> 说明：本模块不要求大家使用 Docker 或容器化技术，支持本地评测和本地安全控制即可，助教验收时会检查你的安全控制逻辑。

**必须防止的危险操作举例：**
- 禁止执行 rm -rf、del /f /q 等删除系统文件的命令。
- 禁止执行格式化磁盘、关机、重启等命令。
- 禁止访问或修改系统敏感目录（如 /etc、C:\Windows 等）。
- 禁止网络访问（如 curl、wget、ping 等），除非明确允许。

**实现建议：**
- 对所有用户提交的代码、系统调用、shell 命令等进行关键字过滤和白名单校验。
- 只允许运行安全的命令和操作。
- 评测环境应有沙箱或隔离机制，限制资源和权限。

**举例：**
- 用户提交的代码中包含 os.system('rm -rf /')，应拒绝评测并提示安全风险。
- 管理员或系统执行 shell 命令前，先检查命令内容，发现危险关键字立即阻止。

---

### 主要 API 设计

#### 1. 数据导出
- 路径：`GET /api/export/`
- 权限：仅管理员
- 参数：`format`（可选，json/csv）
- 返回：所有核心数据的文件

#### 2. 数据恢复
- 路径：`POST /api/import/`
- 权限：仅管理员
- 参数：上传数据文件
- 返回：恢复结果

---

### 能力小结

| 能力项         | 说明                       |
| -------------- | -------------------------- |
| 数据持久化     | 用户、题目、提交、比赛等能安全保存 |
| 断点恢复       | 系统重启后自动恢复所有数据  |
| 安全控制       | 能识别并阻止危险操作        |
| 命令过滤       | 对 shell/系统命令做安全校验 |

---

### 评分细则

| 功能/接口                | 分值 | 评分说明                         |
|--------------------------|------|----------------------------------|
| 数据持久化结构与接口     | 2    | 结构设计、接口一致性              |
| 断点恢复                 | 2    | 启动加载、数据恢复                |
| 危险操作防护             | 2    | 能识别并阻止危险命令              |
| 安全校验实现             | 1    | 关键字过滤、白名单机制            |
| 文档与实现一致性         | 1    | 文档与实际实现同步                |
| **小计**                 | **8**|                                  |

> 完成本 step 后，你将实现核心数据的持久化和断点恢复，具备基础的安全防护能力，防止危险操作，保障系统数据安全和运行稳定。