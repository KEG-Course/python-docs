## Step 7：数据持久化与高可用

---

### 模块目标

实现OJ系统核心数据的持久化，支持高可用和断点恢复。

---

### 前置知识要求

| 技术点         | 推荐学习内容           |
| -------------- | ---------------------- |
| JSON文件操作   | `json.load()` / `json.dump()` |
| SQLite数据库   | Python `sqlite3` 或 ORM |
| 文件/线程锁机制 | `threading.Lock()`、`filelock` |
| 生命周期管理   | 启动/退出时数据加载与保存 |

---

### 任务拆解

#### 任务 1：数据持久化结构与接口
- 目标：设计用户、任务、配置等核心数据的持久化结构，统一接口。
- 要点：支持JSON和SQLite两种后端，字段结构与前面模块一致。
- 建议：日志文件结构与Step6一致。

#### 任务 2：启动加载与并发安全
- 目标：系统启动时自动加载数据，保证并发下数据安全。
- 要点：不存在时创建空白结构，所有写操作加锁。
- 建议：JSON用filelock，SQLite用事务，启动时检查并创建data/、logs/等目录。

---

### 能力小结

| 能力项         | 说明                       |
| -------------- | -------------------------- |
| 数据持久化     | 支持JSON/SQLite两种模式   |
| 结构设计       | 数据结构与业务一致         |
| 统一接口       | 业务逻辑与存储解耦         |
| 并发安全       | 支持多线程/多进程安全写入   |
| 高可用         | 支持断点恢复与自动初始化   |