## Step 5：排行榜机制

---

### 模块目标

实现用户得分排行榜，支持成绩统计、排序与展示。

---

### 前置知识要求

| 技术点         | 推荐学习内容           |
| -------------- | ---------------------- |
| Python 排序    | `sorted()`、key函数    |
| 嵌套字典处理   | `defaultdict(dict)`    |
| 时间戳与比较   | `datetime` 时间处理    |
| RESTful API    | GET参数解析、分页      |

---

### 任务拆解

#### 任务 1：得分统计与结构
- 目标：为每道题配置分值，维护用户-题目得分表和总分。
- 要点：每题只计最高分，更新总分和达成时间。
- 建议：每次评测任务完成后自动更新。

#### 任务 2：排行榜API与排序
- 目标：提供REST API查询排行榜，支持排序、分页、tie-breaker策略。
- 要点：返回结构包含user_id、username、总分、题目分、提交数、更新时间。
- 建议：支持参数order、tie_breaker、page、page_size、limit。

#### 任务 3：实现tie-breaker排序逻辑
- 目标：同分用户支持多种排序策略。
- 要点：支持earliest、latest、random等。
- 建议：排序key需兼容无时间情况。

#### 任务 4：支持分页与结果数限制
- 目标：排行榜支持分页和人数限制。
- 要点：参数page、page_size、limit。
- 建议：最终排序后切片返回。

---

### 能力小结

| 能力项         | 说明                       |
| -------------- | -------------------------- |
| 分值配置       | 支持题目分值灵活配置       |
| 得分统计       | 只计最高分，自动更新总分   |
| 排行榜API      | 支持多种排序与分页         |
| tie-breaker    | 同分用户排序灵活           |
| 分页与限制     | 支持大规模用户高效查询     |
