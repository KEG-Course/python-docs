## Step 5：排行榜与比赛功能

---

### 模块目标

- 实现题目和比赛的排行榜功能，支持分数统计、排序、分页、不同排序策略（tie-breaker）。
- 支持每个题目维护用户的提交状态（如通过/未通过、最高分、提交次数等）。
- 实现比赛功能：管理员可创建比赛，用户可加入比赛，比赛内有独立排行榜和题目状态。

---

### 前置知识要求

| 技术点         | 推荐学习内容           |
| -------------- | ---------------------- |
| 排序与分组     | Python `sorted()`      |
| REST API 设计  | GET/POST 路由、分页    |
| 数据聚合       | 分组统计、最大分数     |
| 关联建模       | 比赛-题目-用户关系     |

---

### 任务分解

#### 任务 1：题目用户提交状态维护
- 目标：为每个题目维护每个用户的提交状态。
- 要点：包括通过/未通过、最高分、提交次数、最后提交时间等，便于排行榜和比赛统计。

#### 任务 2：排行榜查询
- 目标：提供 API 查询题目/比赛的排行榜。
- 要点：支持按总分、单题分、提交次数等排序，支持分页和多种 tie-breaker 策略。

#### 任务 3：比赛功能
- 目标：支持管理员创建比赛，配置比赛题目和时间，用户可报名/加入比赛。
- 要点：比赛内有独立排行榜和题目状态，比赛期间只统计比赛内提交。

---

### 主要 API 设计

#### 1. 查询排行榜
- 路径：`GET /api/ranklist/`
- 参数：
  - `problem_id` (int, 可选): 按题目筛选
  - `contest_id` (int, 可选): 按比赛筛选
  - `order` (str, 可选): 排序字段（如 "score"、"submit_count"）
  - `tie_breaker` (str, 可选): 同分排序策略（如 "earliest"、"latest"、"random"）
  - `page` (int, 可选): 页码
  - `page_size` (int, 可选): 每页数量
- 响应结构同前

#### 2. 查询题目用户提交状态
- 路径：`GET /api/problems/{problem_id}/status`
- 参数：`user_id` (可选，默认当前用户)
- 返回：通过/未通过、最高分、提交次数、最后提交时间等

#### 3. 比赛管理
- 创建比赛：`POST /api/contests/`（仅管理员）
- 加入比赛：`POST /api/contests/{contest_id}/join`
- 查询比赛信息/题目/排行榜等

---

### 能力小结

| 能力项         | 说明                       |
| -------------- | -------------------------- |
| 排行榜         | 支持总分、单题分、提交数   |
| 题目状态       | 维护每题每用户的提交状态   |
| 比赛功能       | 支持比赛创建、报名、独立榜 |
| 分页与排序     | 支持分页与多种排序策略     |
| tie-breaker    | 同分用户多种排序方式       |
| 数据聚合       | 支持分组统计与聚合         |

---

### 评分细则

| 功能/接口                | 分值 | 评分说明                         |
|--------------------------|------|----------------------------------|
| 排行榜查询接口           | 2    | 路径、参数、响应、分页            |
| 题目用户状态维护         | 1    | 题目-用户状态统计                |
| 比赛创建与加入           | 1    | 比赛管理、用户参赛                |
| 排序与 tie-breaker 策略  | 1    | 多种排序、同分处理                |
| 响应结构与异常处理       | 1    | 结构规范、异常说明                |
| 文档与实现一致性         | 1    | 文档与实际实现同步                |
| **小计**                 | **7**|                                  |

> 完成本 step 后，你将实现题目和比赛的排行榜、用户提交状态统计，以及比赛的创建和参赛功能，支持多种排序和公平竞赛。