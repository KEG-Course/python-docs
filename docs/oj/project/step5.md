## Step 5：排行榜

---

### 模块目标

实现比赛/题目的排行榜功能，支持分数统计、排序、分页、不同排序策略（tie-breaker）。

---

### 前置知识要求

| 技术点         | 推荐学习内容           |
| -------------- | ---------------------- |
| 排序与分组     | Python `sorted()`      |
| REST API 设计  | GET 路由、分页         |
| 数据聚合       | 分组统计、最大分数     |

---

### 任务分解

#### 任务 1：排行榜查询
- 目标：提供 API 查询比赛/题目的排行榜。
- 要点：支持按总分、单题分、提交次数等排序。

#### 任务 2：分页与排序策略
- 目标：排行榜支持分页、不同 tie-breaker 策略（如 earliest、latest、random）。
- 要点：参数可选，默认按总分降序、最早达成优先。

---

### 主要 API 设计

#### 1. 查询排行榜
- 路径：`GET /api/ranklist/`
- 参数：
  - `problem_id` (int, 可选): 按题目筛选
  - `order` (str, 可选): 排序字段（如 "score"、"submit_count"）
  - `tie_breaker` (str, 可选): 同分排序策略（如 "earliest"、"latest"、"random"）
  - `page` (int, 可选): 页码
  - `page_size` (int, 可选): 每页数量
- 响应：
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "total": 2,
    "ranklist": [
      {"user_id": 1, "username": "alice", "score": 300, "problems": {"1001": 100, "1002": 200}, "submit_count": 5, "last_update": "2024-06-01T12:00:00"}
    ]
  }
}
```
- 异常：无

---

### 状态码与异常
- 详见 [api.md](../api.md)
- 资源不存在：404
- 其他错误：500

---

### 能力小结

| 能力项         | 说明                       |
| -------------- | -------------------------- |
| 排行榜         | 支持总分、单题分、提交数   |
| 分页与排序     | 支持分页与多种排序策略     |
| tie-breaker    | 同分用户多种排序方式       |
| 数据聚合       | 支持分组统计与聚合         |

---

**所有 API 需严格遵循 [api.md](../api.md) 规范。**

### 评分细则

| 功能/接口                | 分值 | 评分说明                         |
|--------------------------|------|----------------------------------|
| 排行榜查询接口           | 2    | 路径、参数、响应、分页            |
| 排序与 tie-breaker 策略  | 2    | 多种排序、同分处理                |
| 响应结构与异常处理       | 1    | 结构规范、异常说明                |
| 文档与实现一致性         | 1    | 文档与实际实现同步                |
| **小计**                 | **6**|                                  |
