## Advance 3：安全机制

---

> 先前不要求大家使用 Docker，本模块需要同学使用 Docker 实现沙箱隔离和安全机制。所有评测任务需在 Docker 容器中运行，利用容器技术实现系统调用、资源、网络等的隔离和限制，提升 OJ 系统的安全性。

---

### 模块目标

实现 OJ 系统的安全机制，包括沙箱隔离、内存/时间限制、命令过滤等，防止恶意代码危害系统。

---

### 前置知识要求

| 技术点         | 推荐学习内容           |
| -------------- | ---------------------- |
| 沙箱技术       | seccomp、Docker        |
| 资源限制       | resource、cgroups      |
| 命令过滤       | 黑名单/白名单策略      |

---

### 任务分解

#### 任务 1：沙箱隔离
- 目标：所有评测任务在沙箱环境中运行。
- 要点：限制系统调用、文件访问、网络等。

#### 任务 2：内存/时间限制
- 目标：对评测进程设置严格的内存和时间限制。
- 要点：超限时自动终止进程，返回相应状态。

#### 任务 3：命令过滤与校验
- 目标：对用户提交的命令进行安全校验，防止注入攻击。
- 要点：实现黑名单/白名单机制。

---

### 主要 API 设计（与评测相关接口结合）

- 评测提交：`POST /api/submissions/`（需在沙箱中运行，超限返回 TLE/MLE）
- 语言注册：`POST /api/languages/`（命令需校验）
- 其他接口详见 [api.md](../api.md)

---

### 状态码与异常
- 详见 [api.md](../api.md)
- 超时/超内存：评测状态返回 TLE/MLE

---

### 评分细则

| 功能/接口                | 分值 | 评分说明                         |
|--------------------------|------|----------------------------------|
| 沙箱隔离与资源限制       | 2    | 沙箱说明、内存/时间限制            |
| 命令过滤与安全校验       | 2    | 命令校验、黑白名单                |
| 超限/异常安全响应        | 1    | TLE/MLE 等安全响应                |
| 文档与实现一致性         | 1    | 文档与实际实现同步                |
| **小计**                 | **6**|                                  |