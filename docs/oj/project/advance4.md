## Advance 4：查重系统

---

### 模块目标

实现代码查重与抄袭检测系统，支持查重检测、结果查询、报告下载等功能。

---

### 前置知识要求

| 技术点         | 推荐学习内容           |
| -------------- | ---------------------- |
| 代码相似度算法 | 文本/AST/指纹算法      |
| 文件上传/下载  | FastAPI/Flask 文件接口 |
| REST API 设计  | GET/POST 路由          |

---

### 任务分解

#### 任务 1：查重检测
- 目标：管理员可发起查重检测，对指定题目/用户的提交进行查重。
- 要点：支持多种查重算法，检测结果结构化保存。

#### 任务 2：查重结果查询
- 目标：提供 API 查询查重检测结果。
- 要点：支持按题目/用户/时间筛选。

#### 任务 3：查重报告下载
- 目标：支持下载查重报告（如 PDF/CSV）。
- 要点：仅管理员可下载。

---

### 主要 API 设计

#### 1. 发起查重检测
- 路径：`POST /api/plagiarism/`
- 权限：仅管理员
- 参数：
  - `problem_id` (int): 题目编号
  - `algorithm` (str, 可选): 查重算法（如 "ast"、"text"），默认 text
- 响应：
```json
{
  "code": 200,
  "msg": "plagiarism check started",
  "data": {"task_id": 1}
}
```
- 异常：
  - 400 参数错误
  - 403 权限不足

#### 2. 查询查重结果
- 路径：`GET /api/plagiarism/{task_id}`
- 权限：仅管理员
- 响应：
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "task_id": 1,
    "problem_id": 1001,
    "algorithm": "text",
    "results": [
      {"user_id_1": 1, "user_id_2": 2, "similarity": 0.95}
    ]
  }
}
```
- 异常：
  - 404 任务不存在
  - 403 权限不足

#### 3. 下载查重报告
- 路径：`GET /api/plagiarism/{task_id}/report`
- 权限：仅管理员
- 参数：
  - `format` (str, 可选): 报告格式（"pdf"、"csv"），默认 pdf
- 响应：文件流
- 异常：
  - 404 任务不存在
  - 403 权限不足

---

### 状态码与异常
- 详见 [api.md](../api.md)
- 权限不足：403
- 资源不存在：404
- 其他错误：500

---

### 能力小结

| 能力项         | 说明                       |
| -------------- | -------------------------- |
| 查重检测       | 支持多种查重算法           |
| 结果查询       | 支持结构化查重结果查询     |
| 报告下载       | 支持多格式查重报告下载     |
| 权限控制       | 仅管理员可操作             |

---

**所有 API 需严格遵循 [api.md](../api.md) 规范。**

### 评分细则

| 功能/接口                | 分值 | 评分说明                         |
|--------------------------|------|----------------------------------|
| 查重检测接口             | 2    | 路径、参数、权限、响应            |
| 查重结果查询接口         | 2    | 路径、权限、响应                  |
| 查重报告下载接口         | 1    | 路径、权限、格式                  |
| 权限与安全说明           | 1    | 仅管理员、接口安全                |
| 文档与实现一致性         | 1    | 文档与实际实现同步                |
| **小计**                 | **7**|                                  |