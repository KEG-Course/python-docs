## Step 2：多语言支持

---

### 模块目标

实现 OJ 对多种编程语言的支持，至少包括 C、C++、Python，并支持动态注册新语言。

---

### 前置知识要求

| 技术点         | 推荐学习内容           |
| -------------- | ---------------------- |
| 配置文件操作   | `json.load()`/`dump()` |
| 子进程调用     | `subprocess.run()`     |
| REST API 基础  | FastAPI/Flask 路由设计 |
| 动态注册机制   | 字典、配置热更新       |

---

### 任务分解

#### 任务 1：支持多种语言的评测
- 目标：评测接口支持 C、C++、Python 等多种语言。
- 要点：根据 `language` 字段自动选择编译/运行命令。
- 建议：配置文件中维护语言-命令映射表。

#### 任务 2：动态注册新语言
- 目标：允许管理员通过 API 动态注册新语言。
- 要点：不允许覆盖已有语言名，注册后可持久化到配置文件。

#### 任务 3：查询支持的语言列表
- 目标：提供 API 查询当前支持的所有语言。
- 要点：返回所有已注册语言及其配置信息。

---

### 主要 API 设计

#### 1. 提交评测（复用 Step1 API）
- 路径：`POST /api/submissions/`
- 详见 [api.md](../api.md)
- 说明：`language` 字段决定评测所用语言，若不支持则返回 400。

#### 2. 动态注册新语言
- 路径：`POST /api/languages/`
- 权限：仅管理员
- 参数：
  - `name` (str): 语言名（如 "go"）
  - `compile_cmd` (str, 可选): 编译命令
  - `run_cmd` (str): 运行命令
- 响应：
```json
{
  "code": 200,
  "msg": "language registered",
  "data": {"name": "go"}
}
```
- 异常：
  - 400 参数错误/已存在
  - 403 权限不足
- 安全说明：需校验管理员权限，命令字符串需做安全校验。

#### 3. 查询支持语言列表
- 路径：`GET /api/languages/`
- 参数：无
- 响应：
```json
{
  "code": 200,
  "msg": "success",
  "data": [
    {"name": "python", "run_cmd": "python3 {source}"},
    {"name": "c", "compile_cmd": "gcc {source} -o {exe}", "run_cmd": "{exe}"}
  ]
}
```
- 异常：无

---

### 状态码与异常
- 详见 [api.md](../api.md)
- 语言不支持：400
- 权限不足：403
- 其他错误：500

---

### 能力小结

| 能力项         | 说明                       |
| -------------- | -------------------------- |
| 多语言支持     | 至少支持 C/C++/Python      |
| 动态注册       | 支持运行时注册新语言       |
| 语言查询       | 提供所有支持语言的 API     |
| 安全校验       | 注册命令需校验，防注入     |

---

**所有 API 需严格遵循 [api.md](../api.md) 规范。**

### 评分细则

| 功能/接口                | 分值 | 评分说明                         |
|--------------------------|------|----------------------------------|
| 多语言评测支持           | 2    | 评测接口支持多语言                |
| 动态注册新语言接口       | 3    | 路径、参数、响应、权限、安全      |
| 查询支持语言列表接口     | 1    | 路径、响应                       |
| 命令安全校验             | 2    | 命令校验、沙箱说明                |
| 文档与实现一致性         | 1    | 文档与实际实现同步                |
| **小计**                 | **9**|                                  |